var helpers={findAverages:function(e){var t={};for(var o in e){var n=Array.from(e[o]).filter(e=>e.innerText>0);n.reduce(function(e,t){return total=e+parseFloat(t.innerText)},0),t[o]=(total/n.length).toFixed(2)}return t}},api=function(){return{getGoogle:function(e){e.forEach(function(e){fetch(`https://protected-ravine-77562.herokuapp.com/https://maps.googleapis.com/maps/api/place/details/json?placeid=${e.id}&key=AIzaSyALgMeJoWoeLiygtjWOu1uRou7vJRzQg0I`).then(e=>e.json()).then(t=>{var o=document.querySelector(`#${e.id}`),n=t.result.rating;o.innerText=n.toFixed(2)}).catch(e=>{console.log(e)})})},getFacebook:function(e){e.forEach(function(e){fetch(`https://graph.facebook.com/v2.11/${e.id}?fields=overall_star_rating`,{headers:{Authorization:"Bearer 1964498370470979|7mIH6fntq1SAW47PsrRxx21ds7I"}}).then(e=>e.json()).then(t=>{var o=document.querySelector(`#${e.id}`),n=t.overall_star_rating;o.innerText=n.toFixed(2)}).catch(e=>{console.log(`${e}: Most likely this error is due to the business having no data`)})})},getYelp:function(e){e.forEach(function(e){new RapidAPI("storeranking","9ff7edb4-d7e5-43f8-92d2-4fb7f22a46eb").call("YelpAPI","getSingleBusiness",{accessToken:"F3ij6D_zmlD6kdK_959yHBHH--ANWterrg512Weg1bWUNKL7abbhnVq8uzaLkbF3ZPbOgImcT61iUvAcub0EG9FiprWNL6LYzHvgNJpSjBzPiQStRA4z5JhUZxmCWnYx",bussinessId:e.id}).on("success",function(t){var o=document.querySelector(`#${e.id}`),n=t.rating;o.innerText=n.toFixed(2)}).on("error",function(e){})})}}}(),uiController=function(){var e,t,o,n,r,l,i,a,c,s,d,u,g,m;e=document.createDocumentFragment(),t=document.querySelector(".chevron-down"),o=document.querySelector(".chevron-up"),n=document.querySelector("#toggle-button"),r=document.querySelector("#sidebar"),l=document.querySelectorAll(".store-list-item"),m=document.querySelector("#main"),i=document.querySelector("#table"),a=document.querySelector(".facebookAvgDisplay"),c=document.querySelector("#facebookBar"),s=document.querySelector(".googleAvgDisplay"),d=document.querySelector("#googleBar"),u=document.querySelector(".yelpAvgDisplay"),g=document.querySelector("#yelpBar");var p=function(){o.classList.toggle("active"),t.classList.toggle("active"),r.classList.toggle("hidden"),r.classList.contains("hidden")?m.classList.remove("slider"):m.classList.add("slider")};r.setAttribute("aria-expanded","true"===r.getAttribute("aria-expanded")?"false":"true");return{toggler:p,toggleButton:n,sidebarListItem:l,makeActive:function(e){var t=document.querySelector(".list-active"),o=document.querySelector("#"+e);t&&t.classList.toggle("list-active"),o.classList.toggle("list-active"),window.innerWidth<768&&p()},buildSideList:function(){var t;return(t=document.createElement("ul")).className="list-unstyled list-inline text-left mb-5",Object.keys(storeInfo).forEach(function(o){var n=document.createElement("li"),r=o.substr(1);e.appendChild(n),n.appendChild(document.createTextNode(`# ${r}`)),n.className="store-list-item list-inline-item py-3 pl-5",n.id=o,t.appendChild(e)}),t},makeTable:function(t){var o,n;return o=document.createElement("thead"),headRow=document.createElement("tr"),n=document.createElement("tbody"),e.append.table,i.appendChild(o),i.appendChild(headRow),i.appendChild(n),headRow.innerHTML='<th scope ="col">Store</th >\n            <th scope="col">Facebook</th>\n            <th scope="col">Google</th>\n            <th scope="col">Yelp</th>',t.forEach(function(e){storeNum=e.sNumber,facebookId=e.facebookId,googleId=e.googleId,yelpId=e.yelpId,n.innerHTML+=`<tr>\n                <th scope="row" id="${storeNum}" >${storeNum}\n                <td class="facebookRating" id="${facebookId}">0</td>\n                <td class="googleRating" id="${googleId}">0</td>\n                <td class="yelpRating" id="${yelpId}">0</td>\n                </th>\n                </tr>`}),a.innerHTML="Doin' Some Math",c.style.width=0,c.setAttribute("aria-valuenow",0),s.innerHTML="Doin' Some Math",d.style.width=0,d.setAttribute("aria-valuenow",0),u.innerHTML="Doin' Some Math",g.style.width=0,g.setAttribute("aria-valuenow",0),e},table:i,setAverages:function(e){a.innerHTML=e.facebookIds,c.style.width=parseInt(e.facebookIds/5*100)+"%",c.setAttribute("aria-valuenow",parseInt(e.facebookIds/5*100)+"%"),s.innerHTML=e.googleIds,d.style.width=parseInt(e.googleIds/5*100)+"%",d.setAttribute("aria-valuenow",parseInt(e.googleIds/5*100)+"%"),u.innerHTML=e.yelpIds,g.style.width=parseInt(e.yelpIds/5*100)+"%",g.setAttribute("aria-valuenow",parseInt(e.yelpIds/5*100)+"%")}}}(),controller={init(){document.querySelector("#side-bar-list").appendChild(uiController.buildSideList()),uiController.sidebarListItem=document.querySelectorAll(".store-list-item"),uiController.toggleButton.addEventListener("click",function(){uiController.toggler()}),uiController.sidebarListItem.forEach(e=>{e.addEventListener("click",function(e){var t=e.target.id;uiController.makeActive(t),setTimeout(function(){var e={facebookIds:document.querySelectorAll(".facebookRating"),googleIds:document.querySelectorAll(".googleRating"),yelpIds:document.querySelectorAll(".yelpRating")},t=helpers.findAverages(e);uiController.setAverages(t)},8e3),uiController.table.innerHTML=" ",uiController.makeTable(storeInfo[t]);var o=document.querySelectorAll(".facebookRating"),n=document.querySelectorAll(".googleRating"),r=document.querySelectorAll(".yelpRating");api.getGoogle(n),api.getFacebook(o),api.getYelp(r)})})}};$("#featuresModal").modal("show"),controller.init();